{% if cart is not defined %}
    {% set cart = craft.commerce.carts.cart %}
{% endif %}

{% if not currentUser and not cart.email %}
    {% redirect 'checkout/login' %}
{% endif %}

{% if cart.lineItems|length == 0 %}
    {% redirect '/' %}
{% endif %}

{% extends "_layouts/react" %}
{% includeJsFile "https://js.stripe.com/v3/" %}
{% includeJsFile "https://www.paypalobjects.com/api/checkout.js" %}
{% includeJsFile "/dist/js/checkout.bundle.js" %}
{% includeCssFile "/dist/css/checkout.bundle.css" %}

{% set orderRedirect =  '/shop/customer/order?number='~cart.number  %}

{% set token %}
    window.csrfTokenValue = "{{ craft.app.request.csrfToken }}";
    window.cancelRedirect = "{{ '/shop/checkout/payment' | hash }}";
    window.orderRedirect = "{{ orderRedirect | hash }}";
    window.actionUrl = "{{ actionUrl('commerce/payments/pay') }}";
{% endset %}
{% includeJs token first %}
