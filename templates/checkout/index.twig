{% if cart is not defined %}
    {% set cart = craft.commerce.carts.cart %}
{% endif %}

{% if not currentUser and not cart.email %}
    {% redirect 'checkout/login' %}
{% endif %}

{% if cart.lineItems|length == 0 %}
    {% redirect '/' %}
{% else %}
    {% set orderItem = cart.lineItems|first %}
    {% set product = orderItem.snapshot.product %}

    {% if product is defined and product.experienceFeaturedDescription %}
        {% set productDesc = product.experienceFeaturedDescription %}
    {% endif %}

    {% if product is defined and product.url %}
        {% set productUrl = product.url %}
    {% endif %}
{% endif %}

{% extends "_layouts/react" %}
{% includeJsFile "https://js.stripe.com/v3/" %}
{% includeJsFile "https://www.paypalobjects.com/api/checkout.js" %}
{% includeJsFile "/dist/js/checkout.bundle.js" %}
{% includeCssFile "/dist/css/checkout.bundle.css" %}

{% set orderRedirect =  '/checkout/success' %}

{% set token %}
    window.csrfTokenValue = "{{ craft.app.request.csrfToken }}";
    window.cancelRedirect = "{{ '/shop/checkout/payment' | hash }}";
    window.orderRedirect = "{{ orderRedirect }}";
    window.email = "{{ cart.email }}";
    window.actionUrl = "{{ actionUrl('commerce/payments/pay') }}";
    window.productDesc = "{{ productDesc }}";
    window.productUrl = "{{ productUrl }}";
{% endset %}
{% includeJs token first %}
